#!/bin/sh
# BRICKS the Gfwed domains list by @leaskh

searchDomain() {
    grep "$1" $brickFile
}

addDomain() {
    if [ "$1" = '' ]; then
        echo 'Domain can not be empty!';
        exit 1
    fi
    echo $1 >> $brickFile
    cleanList
}

removeDomain() {
    grep -v "$1" $brickFile > $brickFile.temp
    mv $brickFile.temp $brickFile
    cleanList
}

cleanList() {
    sort -u $brickFile -o $brickFile
    echo 'Done :)'
}

showHelp() {
    echo '- search : Search for domains in BRICKS'
    echo '- add    : Add domain to BRICKS'
    echo '- remove : Remove domain from BRICKS'
    echo '- clean  : Sort & uniq domains in BRICKS'
    echo '- helps  : Show this infos'
}

unknowCommand() {
    showHelp
    exit 1
}

# BlackBox configurations
brickFile=./gfw.bricks

# Main logic
case "$1" in
    'search') searchDomain $2;;
    'add'   ) addDomain    $2;;
    'remove') removeDomain $2;;
    'clean' ) cleanList      ;;
    'help'  ) showHelp       ;;
    *       ) unknowCommand  ;;
esac
exit 0
